<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ãƒ‘ãƒ³ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root {
        --easing: cubic-bezier(.2, 1, .2, 1);
        --transition: .8s var(--easing);
        --color-base: #f0f8ff;
        --color-gray: #ddd;
        --color-theme: #f5695f; /* èµ¤ç³»ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ */
        --color-theme-darken: #f12617;
        --box-shadow: .8rem .8rem 1.2rem rgba(0, 0, 0, .05), -.8rem -.8rem 1.2rem #fff;
        --box-shadow-hover: 1rem 1rem 1.5rem rgba(0, 0, 0, .08), -1rem -1rem 1.5rem #fff;
        --box-shadow-inset: inset .8rem .8rem 1.2rem rgba(0, 0, 0, .05), inset -.8rem -.8rem 1.2rem #fff;
        --box-shadow-dark: .8rem .8rem 1.2rem rgba(0, 0, 0, 0.1), -.8rem -.8rem 1.2rem rgba(#fff,.2);
      }

      html {
        font-family: "Helvetica Neue",
          Arial,
          "Hiragino Kaku Gothic ProN",
          "Hiragino Sans",
          Meiryo,
          sans-serif;
        font-size: 62.5%;
        line-height: 1.8;
        height: 100%;
        word-break: break-word;
        color: #333;
        background-color: var(--color-base);
        -webkit-appearance: none;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        font-size: 1.6rem;
        padding: 20px;
        margin: 0;
      }

      main {
        display: block;
        max-width: 1000px;
        margin: 0 auto;
      }

      /* --- ãƒã‚¹ã‚­ãƒ³ã‚°é–¢é€£ã®èª¿æ•´ --- */
      /* ãƒã‚¹ã‚­ãƒ³ã‚°ãŒé©ç”¨ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒŠ (åœ°åŸŸå + (æ•°å€¤)) */
      .masked .rank-content {
        background-color: var(--color-gray);
        color: transparent;
        border-radius: 0.5rem; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦å°‘ã—å¤§ãã */
        transition: background-color 0.3s;
        pointer-events: none; /* ãƒã‚¹ã‚­ãƒ³ã‚°ä¸­ã¯ã‚¯ãƒªãƒƒã‚¯ä¸å¯ */
        min-width: 25rem; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦èª¿æ•´ */
      }
      
      .rank-item.masked {
        cursor: pointer;
      }
      
      .rank-item:not(.masked) {
        cursor: default;
      }

      /* --- é †ä½åˆ¥ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¨ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º (2å€åŒ–) --- */
      /* é †ä½ç•ªå·ã®å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
      .rank-num {
        font-weight: 800;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      /* åœ°åŸŸåã¨æ•°å€¤ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºèª¿æ•´ */
      .region-name {
        font-weight: 700;
      }
      .value-data {
        font-size: 0.8em; /* åœ°åŸŸåã‚ˆã‚Šå°‘ã—å°ã•ã (ç›¸å¯¾ã‚µã‚¤ã‚ºã¯ç¶­æŒ) */
        font-weight: 400;
        margin-left: 1rem; /* ã‚¹ãƒšãƒ¼ã‚¹ã‚’åºƒã */
      }
      
      /* 1ä½ã‹ã‚‰3ä½ã®ç‰¹åˆ¥ãªã‚¹ã‚¿ã‚¤ãƒ« */
      /* å…ƒ: 4rem, 3.5rem, 3rem -> 2å€åŒ– */
      .rank-1 .rank-num { font-size: 8rem; color: #FFD700; }
      .rank-2 .rank-num { font-size: 7rem; color: #C0C0C0; }
      .rank-3 .rank-num { font-size: 6rem; color: #CD7F32; }
      
      .rank-1, .rank-2, .rank-3 {
        background-color: #fffacd;
        border: 6px solid var(--color-theme); /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦å¤ªã */
        border-radius: 1.5rem;
        box-shadow: var(--box-shadow-hover);
        padding: 2rem !important; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦åºƒã */
      }

      /* 10ä½ã¾ã§ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      /* å…ƒ: 2.5rem -> 2å€åŒ– */
      .rank-item.top-10:not(.rank-1):not(.rank-2):not(.rank-3) .rank-num {
        font-size: 5rem;
      }
      .rank-item.top-10 {
        max-width: 800px; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦åºƒã */
        margin-left: auto;
        margin-right: auto;
        margin-bottom: 1rem; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦åºƒã */
        padding: 1.5rem; /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦åºƒã */
      }
      .rank-item.top-10:not(.rank-1):not(.rank-2):not(.rank-3) {
        border-left: 10px solid var(--color-theme); /* ã‚µã‚¤ã‚ºæ‹¡å¤§ã«åˆã‚ã›ã¦å¤ªã */
        border-radius: 1rem;
      }
      
      /* 1ä½ã€œ10ä½ã®åœ°åŸŸå/æ•°å€¤ã®ãƒ™ãƒ¼ã‚¹ã‚µã‚¤ã‚º */
      /* å…ƒ: text-3xl/2xl/xl -> Tailwindã®å¯¾å¿œã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ã‚«ã‚¹ã‚¿ãƒ  */
      .rank-1 .region-name, .rank-1 .rank-content { font-size: 4rem; } 
      .rank-2 .region-name, .rank-2 .rank-content { font-size: 3.5rem; }
      .rank-3 .region-name, .rank-3 .rank-content { font-size: 3.5rem; }
      .rank-item.top-10:not(.rank-1):not(.rank-2):not(.rank-3) .region-name,
      .rank-item.top-10:not(.rank-1):not(.rank-2):not(.rank-3) .rank-content { font-size: 3rem; }


      /* 11ä½ä»¥ä¸‹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
      /* å…ƒ: 1.8rem -> 2å€åŒ– */
      .rank-item.below-10 {
        font-size: 3.6rem;
        max-width: 700px;
        margin-left: auto;
        margin-right: auto;
        padding: 1rem 0;
        border-bottom: 2px dashed var(--color-gray);
      }
      .rank-item.below-10 .rank-num { font-size: 3rem; }
      .rank-item.below-10 .region-name, .rank-item.below-10 .rank-content { font-size: 3rem; }

      
      /* --- ãã®ä»–æ—¢å­˜ã®CSSã¯çœç•¥ --- */

      .breadcrumb {
        height: 4vh;
        margin: 0;
        padding: 0 20px;
        list-style: none;
      }
      /* (ãƒ‘ãƒ³ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã®navã‚¹ã‚¿ã‚¤ãƒ«ã¯å¤‰æ›´ã—ãªã„) */
      .breadcrumb li {
        display: inline;
        list-style: none;
        font-weight: bold;
        text-align: center;
        line-height: 4vh;
        font-size: 1.5rem; /* navã¯ã‚µã‚¤ã‚ºç¶­æŒ */
      }
      .breadcrumb li a {
        font-size: 1.5rem; /* navã¯ã‚µã‚¤ã‚ºç¶­æŒ */
      }
      .breadcrumb li:last-child a {
        font-size: 1.5rem; /* navã¯ã‚µã‚¤ã‚ºç¶­æŒ */
      }
    </style>
  </head>
  <body>
    <main>
      <nav class="breadcrumb">
        <ol itemscope itemtype="http://schema.org/BreadcrumbList">
          <li
            itemprop="itemListElement"
            itemscope
            itemtype="http://schema.org/ListItem"
          >
            <a itemprop="item" href="https://panzuki.github.io/3sp/"
              ><span itemprop="name">ãƒ›ãƒ¼ãƒ </span></a
            >
            <meta itemprop="position" content="1" />
          </li>
          <li
            class="page"
            itemprop="itemListElement"
            itemscope
            itemtype="http://schema.org/ListItem"
          >
            <a itemprop="item" href="" tabindex="-1"
              ><span itemprop="name">ãƒ‘ãƒ³ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span></a
            >
            <meta itemprop="position" content="2" />
          </li>
        </ol>
      </nav>
      
      <div class="bg-white p-6 rounded-xl shadow-lg mb-8 border-t-4 border-red-500 max-w-2xl mx-auto">
        
        <div class="mb-6 pb-4 border-b border-gray-200">
          <label for="tsv-file-input" class="text-xl font-bold text-gray-700 block mb-3 text-center">
            ğŸ“Š TSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
          </label>
          <input 
            type="file" 
            id="tsv-file-input" 
            accept=".tsv" 
            class="block w-full text-lg text-gray-700 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-lg file:font-semibold file:bg-red-50 file:text-red-700 hover:file:bg-red-100 cursor-pointer"
          />
        </div>
        
        <div class="flex flex-col md:flex-row justify-center items-center space-y-4 md:space-y-0 md:space-x-6">
          
          <div class="flex items-center space-x-3 w-full md:w-auto justify-center">
            <label for="ranking-item" class="text-lg font-semibold text-gray-700 whitespace-nowrap">é …ç›®:</label>
            <select id="ranking-item" class="border border-gray-300 rounded-lg p-3 text-lg focus:ring-red-500 focus:border-red-500 shadow-sm w-full md:w-48">
              </select>
          </div>

          <div class="flex items-center space-x-4">
            <span class="text-lg font-semibold text-gray-700 whitespace-nowrap">ä¸¦ã³é †:</span>
            <div class="flex space-x-4 bg-gray-100 p-3 rounded-lg shadow-inner">
              <label class="inline-flex items-center">
                <input type="radio" name="sort-order" value="desc" checked class="form-radio text-red-600 h-6 w-6 focus:ring-red-500" />
                <span class="ml-2 text-gray-700 text-lg">é™é †</span>
              </label>
              <label class="inline-flex items-center">
                <input type="radio" name="sort-order" value="asc" class="form-radio text-red-600 h-6 w-6 focus:ring-red-500" />
                <span class="ml-2 text-gray-700 text-lg">æ˜‡é †</span>
              </label>
            </div>
          </div>
          
        </div>
      </div>
      
      <h1 id="main-title" class="text-5xl md:text-7xl font-extrabold text-gray-800 my-10 text-center tracking-tight">ãƒ‘ãƒ³ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°</h1>

      <div id="source-info" class="text-center mb-8 text-xl text-gray-600 italic p-4 bg-gray-100 rounded-lg shadow-inner max-w-3xl mx-auto">
        ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...
      </div>

      <div id="ranking-container" class="space-y-5">
        <button id="show-all-button" class="hidden w-full bg-red-500 hover:bg-red-600 text-white font-bold py-4 px-6 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.01] text-2xl max-w-lg mx-auto">
          11ä½ä»¥ä¸‹ã®é †ä½ã‚’ä¸€æ°—ã«è¡¨ç¤ºï¼
        </button>
        <ul id="ranking-list" class="space-y-4 pt-6">
          <li class="text-center text-gray-500 text-2xl py-12">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</li>
        </ul>
      </div>

    </main>
    <script>
      // åˆæœŸãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ (ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãŒãªã„å ´åˆã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
      let currentTSVPath = 'tsv/(å“ç›®åˆ†é¡)ç¬¬ï¼–è¡¨éƒ½å¸‚éšç´šãƒ»åœ°æ–¹ãƒ»éƒ½é“åºœçœŒåºæ‰€åœ¨å¸‚åˆ¥ï¼‘ä¸–å¸¯å½“ãŸã‚Šå¹´é–“ã®å“ç›®åˆ¥æ”¯å‡ºé‡‘é¡è³¼å…¥æ•°é‡ï¼ˆäºŒäººä»¥ä¸Šã®ä¸–å¸¯ï¼‰ä»¤å’Œï¼–å¹´2024.tsv';
      let rankingData = [];
      let columnNames = [];
      
      const fileInput = document.getElementById('tsv-file-input');
      const titleElement = document.getElementById('main-title');
      const itemSelect = document.getElementById('ranking-item');
      const sortOrderInputs = document.querySelectorAll('input[name="sort-order"]');
      const rankingList = document.getElementById('ranking-list');
      const showAllButton = document.getElementById('show-all-button');
      const sourceInfoElement = document.getElementById('source-info');

      /**
       * ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰å¼•ç”¨å…ƒæƒ…å ±ã‚’æŠ½å‡ºã—ã¦è¡¨ç¤ºã™ã‚‹
       * @param {string} fileName - ãƒ•ã‚¡ã‚¤ãƒ«åå…¨ä½“
       * @param {boolean} isFileObject - Fileã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®èª­ã¿è¾¼ã¿ã‹ã©ã†ã‹
       */
      function displaySourceInfo(fileName, isFileObject = false) {
        // æ‹¡å¼µå­ã‚’é™¤å»
        const baseName = fileName.replace(/\.[^/.]+$/, ""); 

        let info = 'å¼•ç”¨å…ƒï¼š';
        
        if (isFileObject) {
            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã€baseNameå…¨ä½“ã‚’è¡¨ç¤º
            info += baseName;
        } else {
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ã‚¹ã®å ´åˆã€æ‹¬å¼§å†…ã®æƒ…å ±ã‚’æŠ½å‡ºã—ã¦è¡¨ç¤º
            const matches = [...baseName.matchAll(/\((.*?)\)/g)];
            if (matches.length > 0) {
                const extractedInfo = matches.map(match => match[1]).join(' / ');
                info += `ã€Œ${extractedInfo}ã€`;
            } else {
                info += baseName;
            }
        }
        
        sourceInfoElement.textContent = info;
      }
      
      /**
       * TSVãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹
       * @param {string} text - TSVãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹
       */
      function parseTSV(text) {
          const lines = text.trim().split('\n');
          
          // 1è¡Œç›®ãŒé …ç›®åï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ï¼‰
          columnNames = lines[0].split('\t').slice(1).map(name => name.trim());

          // 2è¡Œç›®ä»¥é™ãŒãƒ‡ãƒ¼ã‚¿
          rankingData = lines.slice(1).map(line => {
            const values = line.split('\t');
            const data = { prefecture: values[0].trim() };
            values.slice(1).forEach((val, index) => {
              data[columnNames[index]] = parseFloat(val);
            });
            return data;
          }).filter(data => data.prefecture);
      }

      /**
       * TSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿ã€ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ (Fetch APIã¾ãŸã¯FileReader)
       * @param {File | string} source - Fileã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¾ãŸã¯URLãƒ‘ã‚¹
       */
      async function loadTSV(source) {
        let text = '';
        let fileName = '';

        if (typeof source === 'string') {
            // URLãƒ‘ã‚¹ã‹ã‚‰ã®èª­ã¿è¾¼ã¿ (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
            fileName = source.split('/').pop();
            try {
                const response = await fetch(source);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                text = await response.text();
            } catch (error) {
                console.error('Error loading TSV from URL:', error);
                sourceInfoElement.textContent = `ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆ${source}ï¼‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`;
                rankingList.innerHTML = `<li class="text-center text-red-500 text-3xl py-12">ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</li>`;
                return;
            }
            displaySourceInfo(fileName, false);

        } else if (source instanceof File) {
            // Fileã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã®èª­ã¿è¾¼ã¿ (ãƒ¦ãƒ¼ã‚¶ãƒ¼é¸æŠ)
            fileName = source.name;
            try {
                text = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = (e) => reject(e);
                    reader.readAsText(source);
                });
            } catch (error) {
                console.error('Error reading selected file:', error);
                sourceInfoElement.textContent = `é¸æŠã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚`;
                rankingList.innerHTML = `<li class="text-center text-red-500 text-3xl py-12">ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</li>`;
                return;
            }
            displaySourceInfo(fileName, true);
        }
        
        parseTSV(text);
        populateItemSelect();
        updateRanking();
      }
      
      /**
       * é …ç›®é¸æŠãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã‚’ç”Ÿæˆ
       */
      function populateItemSelect() {
        itemSelect.innerHTML = '';
        columnNames.forEach(column => {
          const option = document.createElement('option');
          option.value = column;
          option.textContent = column;
          itemSelect.appendChild(option);
        });
      }

      /**
       * ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ã‚½ãƒ¼ãƒˆã—ã¦è¡¨ç¤ºã‚’æ›´æ–°ã™ã‚‹
       * @param {boolean} reMask - ãƒ©ãƒ³ã‚­ãƒ³ã‚°é …ç›®å¤‰æ›´æ™‚ãªã©ã«å…¨ã¦ã‚’ãƒã‚¹ã‚­ãƒ³ã‚°ã™ã‚‹ã‹ã©ã†ã‹
       */
      function updateRanking(reMask = true) {
        const selectedColumn = itemSelect.value;
        const sortOrder = document.querySelector('input[name="sort-order"]:checked').value;
        
        // ã‚¿ã‚¤ãƒˆãƒ«ã‚’æ›´æ–°
        titleElement.textContent = `${selectedColumn || 'ãƒ‘ãƒ³'}ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°`;
        document.querySelector('.page span').textContent = `${selectedColumn || 'ãƒ‘ãƒ³'}ã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°`;

        if (!selectedColumn) {
             rankingList.innerHTML = `<li class="text-center text-gray-500 text-3xl py-12">ãƒ©ãƒ³ã‚­ãƒ³ã‚°é …ç›®ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</li>`;
             showAllButton.classList.add('hidden');
             return;
        }

        // ãƒ‡ãƒ¼ã‚¿ã®ã‚½ãƒ¼ãƒˆ (NaN/nullã‚’æœ€å¾Œã«ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯)
        const sortedData = [...rankingData].sort((a, b) => {
          const valA = a[selectedColumn];
          const valB = b[selectedColumn];
          
          const isNaN_A = isNaN(valA) || valA === null;
          const isNaN_B = isNaN(valB) || valB === null;

          if (isNaN_A && isNaN_B) return 0;
          if (isNaN_A) return 1;
          if (isNaN_B) return -1;
          
          if (sortOrder === 'desc') {
            return valB - valA;
          } else {
            return valA - valB;
          }
        }).filter(data => !(isNaN(data[selectedColumn]) || data[selectedColumn] === null)); // NaNã‚’é™¤å¤–
        
        rankingList.innerHTML = '';

        if (sortedData.length > 10) {
          showAllButton.classList.remove('hidden');
          showAllButton.parentElement.classList.add('text-center');
        } else {
          showAllButton.classList.add('hidden');
        }
        
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¢ã‚¤ãƒ†ãƒ ã®æç”»
        sortedData.forEach((data, index) => {
          const rank = index + 1;
          const value = data[selectedColumn];
          const prefecture = data.prefecture;
          
          const isTop10 = rank <= 10;
          let isMasked = reMask;

          if (rank > 10 && showAllButton.classList.contains('active')) {
              isMasked = false;
          }

          let rankClasses = 'rank-item flex items-center rounded-lg transition-all duration-500 ease-in-out';
          let itemHtml = '';
          let dataValueStyle = 'text-gray-900';
          let rankContentSize = ''; // é †ä½ç•ªå·ã‚µã‚¤ã‚º
          
          // ã‚µã‚¤ã‚ºèª¿æ•´ç”¨ã®CSSã‚¯ãƒ©ã‚¹ã‚’é©ç”¨
          if (isTop10) {
            rankClasses += ' top-10 justify-start space-x-6'; // ã‚¹ãƒšãƒ¼ã‚¹ã‚’åºƒã
            
            if (rank === 1) { rankClasses += ' rank-1'; }
            else if (rank === 2) { rankClasses += ' rank-2'; }
            else if (rank === 3) { rankClasses += ' rank-3'; }
            // é †ä½ã”ã¨ã®ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚ºã¯CSSå´ã§è¨­å®šæ¸ˆã¿
            
            itemHtml = `
              <span class="rank-num w-16 text-center flex-shrink-0">${rank}</span>
              <span class="rank-content font-bold text-gray-800 flex-grow">
                <span class="region-name">${prefecture}</span>
                <span class="value-data ${dataValueStyle}">(${value.toLocaleString()})</span>
              </span>
            `;
            
          } else {
            rankClasses += ' below-10 justify-start space-x-6'; 
            
            itemHtml = `
              <span class="rank-num w-16 text-center flex-shrink-0">${rank}ä½</span>
              <span class="rank-content text-gray-700 flex-grow">
                <span class="region-name">${prefecture}</span>
                <span class="value-data text-gray-500">(${value.toLocaleString()})</span>
              </span>
            `;
          }

          const listItem = document.createElement('li');
          listItem.className = rankClasses + (isMasked ? ' masked' : '');
          listItem.setAttribute('data-rank', rank);
          listItem.innerHTML = itemHtml;
          
          rankingList.appendChild(listItem);
          
          // ãƒã‚¹ã‚­ãƒ³ã‚°è§£é™¤ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¿½åŠ 
          if (isMasked && isTop10) {
            listItem.addEventListener('click', function revealItem(e) {
              // ãƒã‚¹ã‚¯ã•ã‚ŒãŸé ˜åŸŸï¼ˆ.rank-contentï¼‰ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆã®ã¿è§£é™¤
              if (e.target.closest('.rank-item.masked')) {
                listItem.classList.remove('masked');
                listItem.removeEventListener('click', revealItem);
              }
            });
          }
        });
        
        // 11ä½ä»¥ä¸‹ã®è¡¨ç¤ºã‚’ä¸€æ‹¬åˆ¶å¾¡
        if (showAllButton.classList.contains('active')) {
            revealBelow10(false);
        } else if (reMask) {
            maskBelow10(false);
        }
      }

      /**
       * 11ä½ä»¥ä¸‹ã®ãƒã‚¹ã‚­ãƒ³ã‚°ã‚’ä¸€æ‹¬ã§è§£é™¤
       */
      function revealBelow10(updateButton = true) {
        const below10Items = document.querySelectorAll('.rank-item.below-10');
        below10Items.forEach(item => {
          item.classList.remove('masked');
        });
        if (updateButton) {
            showAllButton.classList.add('active');
            showAllButton.textContent = '11ä½ä»¥ä¸‹ã®é †ä½ã¯è¡¨ç¤ºä¸­ã§ã™';
            showAllButton.classList.remove('bg-red-500', 'hover:bg-red-600');
            showAllButton.classList.add('bg-gray-500', 'cursor-default');
        }
      }
      
      /**
       * 11ä½ä»¥ä¸‹ã®ãƒã‚¹ã‚­ãƒ³ã‚°ã‚’å†é©ç”¨ï¼ˆé …ç›®å¤‰æ›´æ™‚ãªã©ï¼‰
       */
      function maskBelow10(updateButton = true) {
        const below10Items = document.querySelectorAll('.rank-item.below-10');
        below10Items.forEach(item => {
          item.classList.add('masked');
        });
        if (updateButton) {
            showAllButton.classList.remove('active');
            showAllButton.textContent = '11ä½ä»¥ä¸‹ã®é †ä½ã‚’ä¸€æ°—ã«è¡¨ç¤ºï¼';
            showAllButton.classList.add('bg-red-500', 'hover:bg-red-600');
            showAllButton.classList.remove('bg-gray-500', 'cursor-default');
        }
      }

      // --- ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š ---
      fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
          const file = e.target.files[0];
          // ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚ŒãŸã‚‰ã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€
          loadTSV(file);
        }
      });
      
      itemSelect.addEventListener('change', () => updateRanking(true));
      
      sortOrderInputs.forEach(input => {
        input.addEventListener('change', () => updateRanking(false));
      });
      
      showAllButton.addEventListener('click', () => {
        if (!showAllButton.classList.contains('active')) {
          revealBelow10(true);
        }
      });

      // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®TSVã‚’èª­ã¿è¾¼ã‚€
      loadTSV(currentTSVPath);
      
      // Tailwindã®ã‚«ã‚¹ã‚¿ãƒ è¨­å®šï¼ˆæ—¢å­˜ã®CSSå¤‰æ•°ã‚’åˆ©ç”¨ï¼‰
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'theme-red': 'var(--color-theme)',
            },
          }
        }
      }
    </script>
  </body>
</html>

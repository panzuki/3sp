<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Interactive Bread Markers with Fabric.js</title>
    <style>
        #canvas-container {
            width: 500px;
            height: 500px;
            margin: 0 auto;
            position: relative;
        }
        .tooltip {
            display: none;
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 5px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="canvas-container">
        <canvas id="breadCanvas"></canvas>
        <div id="tooltip" class="tooltip"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/4.6.0/fabric.min.js"></script>
    <script>
        const canvas = new fabric.Canvas('breadCanvas');
        const images = [
            {
                src: 'images/pan1-1.jpg', // 1枚目の画像パス
                markers: [
                    { label: 'クラスト', x: 150, y: 50, description: 'パンの外側でカリッとした部分' },
                  { label: 'クラム', x: 250, y: 200, description: 'パンの内側の柔らかい部分' }
                ]
            },
            {
                src: 'images/pan1-2.jpg', // 2枚目の画像パス
                markers: [
                    { label: 'クラスト', x: 100, y: 50, description: '別のパンのクラスト' },
                    { label: 'クラム', x: 200, y: 180, description: '別のパンのクラム' }
                ]
            }
        ];
        let currentSlide = 0;
        let activeMarker = null;

        const tooltip = document.getElementById('tooltip');

        function loadImage(slideIndex) {
            canvas.clear();
            const image = images[slideIndex];
            fabric.Image.fromURL(image.src, function(img) {
                img.set({ selectable: false });
                img.scaleToWidth(canvas.width);
                img.scaleToHeight(canvas.height);
                canvas.add(img);
                loadMarkers(image.markers);
            });
        }

        function loadMarkers(markers) {
            markers.forEach((marker, index) => {
                 const circle = new fabric.Circle({
                    radius: 5, fill: 'red', left: marker.x, top: marker.y, selectable: false
                });
                const text = new fabric.Text(marker.label, {
                    fontSize: 14, left: marker.x + 10, top: marker.y - 10, selectable: false
                });

                circle.markerIndex = index;
                circle.on('mousedown', () => showTooltip(marker));
                canvas.add(circle, text);
            });
        }

        function showTooltip(marker) {
            tooltip.style.display = 'block';
            tooltip.style.left = `${marker.x + 20}px`;
            tooltip.style.top = `${marker.y + 20}px`;
            tooltip.innerText = marker.description;
            activeMarker = marker;
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
            activeMarker = null;
        }

        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowLeft') {
                currentSlide = (currentSlide - 1 + images.length) % images.length;
                loadImage(currentSlide);
            }
        });

        canvas.on('mouse:down', (event) => {
            if (!event.target) hideTooltip();
        });

        // 初回のスライド読み込み
        loadImage(currentSlide);
    </script>
</body>
</html>
